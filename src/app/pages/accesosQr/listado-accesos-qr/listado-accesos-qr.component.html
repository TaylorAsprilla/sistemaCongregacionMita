<section class="content">
  <!-- Cargando información -->
  @if (cargando) {
  <app-cargando-informacion></app-cargando-informacion>
  } @if (!cargando && accesosQr.length > 0) {
  <div class="card">
    <!-- Single clean card-header -->
    <div class="card-header d-flex justify-content-between align-items-center bg-white text-dark">
      <div class="col-lg-8 col-md-7 col-12 px-4 pt-4">
        <h3 class="card-title">Total de Accesos QR ({{ accesosQr.length }})</h3>
        <p>Accesos registrados mediante código QR</p>
      </div>
      <div class="d-flex align-items-center flex-wrap">
        <button class="btn btn-primary mx-1 mb-2 mb-md-0 d-flex align-items-center" (click)="crearAccesoqr()">
          <i class="fas fa-user"></i>
          <span class="d-none d-md-inline-block ms-2">Generar QR</span>
        </button>
        <button
          class="btn mx-1 mb-2 mb-md-0 d-flex align-items-center"
          [ngClass]="{ 'btn-secondary': isFiltrosVisibles, 'btn-outline-secondary': !isFiltrosVisibles }"
          (click)="esconderFiltros()"
        >
          <i class="fa fa-filter"></i>
          <span class="d-none d-md-inline-block ms-2">
            {{ isFiltrosVisibles ? 'Ocultar Filtros' : 'Ver Filtros' }}
          </span>
        </button>
      </div>
    </div>

    @if (isFiltrosVisibles) {
    <div>
      @if (accesosQr.length > 0) {
      <div class="card-body">
        <div class="row g-3">
          <div class="col-lg-4 col-md-6 col-12">
            <div class="form-group">
              <label for="selectPais">País</label>
              <select
                id="selectPais"
                class="form-select"
                [(ngModel)]="originalPais"
                (ngModelChange)="filtrarPais($event)"
                #txtPais
              >
                <option value="">Seleccione País</option>
                @for (pais of paises; track pais) {
                <option [ngValue]="pais">{{ pais }}</option>
                }
              </select>
            </div>
          </div>

          <div class="col-lg-4 col-md-6 col-12">
            <div class="form-group">
              <label for="selectCiudad">Ciudad</label>
              <select
                id="selectCiudad"
                class="form-select"
                (ngModelChange)="filtrarCiudad($event)"
                [(ngModel)]="originalCiudad"
              >
                <option value="">Seleccione la Ciudad</option>
                <option value="">Sin Ciudad</option>
                @for (ciudad of ciudades; track ciudad) {
                <option>{{ ciudad }}</option>
                }
              </select>
            </div>
          </div>

          <div class="col-lg-4 col-md-12 col-12">
            <div class="form-group">
              <label>Rango de Fechas</label>
              <div class="d-flex flex-column flex-md-row gap-2">
                <input
                  type="date"
                  class="form-control"
                  [(ngModel)]="fechaInicio"
                  (change)="filtrarPorRangoFechas()"
                  placeholder="Desde"
                />
                <input
                  type="date"
                  class="form-control"
                  [(ngModel)]="fechaFin"
                  (change)="filtrarPorRangoFechas()"
                  placeholder="Hasta"
                />
              </div>
            </div>
          </div>

          <div class="col-lg-8 col-md-8 col-12">
            <div class="form-group">
              <label>Buscar</label>
              <input
                type="search"
                class="form-control"
                [(ngModel)]="filterText"
                placeholder="Buscar..."
                name="filtro"
              />
            </div>
          </div>

          <div class="col-lg-4 col-md-4 col-12 d-flex align-items-end">
            <div class="form-group w-100">
              <button class="btn btn-primary w-100" (click)="resetFiltros()">Reset Filtros</button>
            </div>
          </div>
        </div>
      </div>
      }
    </div>
    }

    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-bordered table-striped mx-auto">
          <thead>
            <tr>
              <th>Usuario</th>
              <th>Dispositivo</th>
              <th>País</th>
              <th>Ciudad</th>
              <th>Fecha</th>
            </tr>
          </thead>
          <tbody>
            @for (acceso of accesosQrFiltrados; track $index) {
            <tr>
              <td class="text-nowrap">{{ acceso.qrAcceso?.nombre }}</td>
              <td class="text-nowrap">{{ acceso.dispositivo }}</td>
              <td class="text-nowrap">{{ acceso.pais }}</td>
              <td class="text-nowrap">{{ acceso.ciudad }}</td>
              <td class="text-nowrap">{{ acceso.createdAt | date : 'short' }}</td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>
  } @if (!cargando && accesosQr.length === 0) {
  <div class="text-center text-gray-500 mt-6">
    <p>No se encontraron accesos registrados.</p>
  </div>
  }
</section>
